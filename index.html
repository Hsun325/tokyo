<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tokyo</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="/icon-192x192.png">
    <link rel="stylesheet" href="style.css"> 
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    
    <header class="app-header">
        <h1>ç‹å°æ£ çš„æ±äº¬ç”Ÿæ—¥ä¹‹æ—… ğŸ±</h1>
    </header>

    <nav class="day-scroll-nav" id="day-tabs-container">
    </nav>
    
    <main class="content-container">
        
        <section id="day-12-27" class="itinerary-day active-page">
            <div class="day-card current-vibe-card" style="background-image: url('image/asukuna.jpg');">
                <p>â›©ï¸ æ·ºè‰</p></div>             
            <div class="day-card detail-card" data-date="12/27" data-city="Sumida">
                <div class="weather-info">
                    12/27 æ·ºè‰ | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 12/27 æ·ºè‰</h2>
                <p>ä½å®¿:èŠ±ç¯‰æ·ºè‰å’Œå¿ƒé£¯åº—</p>              
                <h3>ğŸ“ è¡Œç¨‹</h3>
                <ul>
                    <li>
                        <a id="narita-guide-button" class="action-button">
                            <strong>11:00 æˆç”°æ©Ÿå ´->æ·ºè‰</strong>
                        </a>
                    </li>
                    <li>æ·ºè‰å¯º</li>
                    <li>ä»²è¦‹ä¸–å•†åº—è¡—</li>
                    <li>åˆç¾½æ©‹é“å…·è¡—:å¾€æ™´ç©ºå¡” ç”°åŸç”ºç«™ â†’ æŠ¼ä¸Šç«™</li>                    
                    <li>æ™´ç©ºå¡”:å¾€ç§‹è‘‰åŸ åŠè—é–€ç·šï¼ˆæŠ¼ä¸Šï¼‰ â†’ éŠ€åº§ç·šï¼ˆä¸Šé‡ï¼‰ â†’ ç§‹è‘‰åŸ</li>
                    <li>ç§‹è‘‰åŸ</li>
                </ul>
            </div>
        </section>

         <section id="day-12-28" class="itinerary-day hidden">
             <div class="day-card current-vibe-card" style="background-image: url('image/shibuya-sky.jpg');">
                <p>ğŸ¢ æ–°å®¿ãƒ»æ¾€è°·</p></div>     
             <div class="day-card detail-card" data-date="12/29" data-city="Shibuya">
                <div class="weather-info">
                    12/28 æ–°å®¿ãƒ»æ¾€è°· | å¤©æ°£ï¼šè¼‰å…¥ä¸­... 
                </div>
                <h2>ğŸ—“ï¸ 12/28 æ–°å®¿ã€æ¾€è°·ã€æ±äº¬éµå¡”</h2>             
                <h3>ğŸ“ è¡Œç¨‹</h3>
                <ul>                    
                    <li>æ¾€è°· Shibuya Sky</li>                    
                    <li>æƒ æ¯”å£½</li>
                    <li>æ˜æ²»ç¥å®®</li>
                    <li>18:00 Ushigoro Ginza</li>
                    <li>æ±äº¬éµå¡”</li>
                </ul>
            </div>
        </section>
        
         <section id="day-12-29" class="itinerary-day hidden">
             <div class="day-card current-vibe-card" style="background-image: url('image/sea.jpg');">
                <p>ğŸ¢ Disney Sea</p></div>
                        <div class="day-card detail-card" data-date="12/28" data-city="Urayasu">
                <div class="weather-info">
                    12/29 disney-Sea | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 12/29 disney-Sea </h2>                
                <h3>ğŸš† äº¤é€šï¼š</h3>
                <p>æ·ºè‰ (äººå½¢ç”ºç«™) â†’ æ—¥æ¯”è°·ç·š (å…«ä¸å €ç«™) â†’ JRäº¬è‘‰ç·š â†’ èˆæ¿±ç«™</p>
            </div>
        </section>
       
        <section id="day-12-30" class="itinerary-day hidden">
            <div class="day-card current-vibe-card" style="background-image: url('image/gotokuji.jpg');">
                <p>ğŸ± è±ªå¾·å¯º</p></div>
            <div class="day-card detail-card" data-date="12/30" data-city="Setagaya">
                <div class="weather-info">
                    12/30 è±ªå¾·å¯º | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 12/30 è±ªå¾·å¯º</h2>
                <h3>ğŸš† äº¤é€š</h3>
                <p>æ·ºè‰ï¼ˆG19ï¼‰â†’ éŠ€åº§ç·šï¼ˆGï¼‰â†’ æ¾€è°·ï¼ˆG01ï¼‰</p>
                <p>1.æ¾€è°· â†’ ä¸‰è»’èŒ¶å±‹ ç·šè·¯ï¼šæ±æ€¥ç”°åœ’éƒ½å¸‚ç·š Den-en-toshi Line</p>
                <p>2.ä¸‰è»’èŒ¶å±‹ â†’ å®®ã®å‚ ç·šè·¯ï¼šæ±æ€¥ä¸–ç”°è°·ç·š Setagaya Lineï¼ˆå°é›»è»Šï¼‰</p>
                <p>3.å®®ã®å‚ç«™ â†’ è±ªå¾·å¯º</p>
                <h4>ğŸ“ è¡Œç¨‹</h4>
                <p>å¯ä»¥å†å›æ¾€è°·é€›é€›</p>
            </div>
        </section>

        <section id="day-12-31" class="itinerary-day hidden">
            <div class="day-card current-vibe-card" style="background-image: url('image/fuji.jpg');">
                <p>ğŸ—» å¯Œå£«å±±</p></div>
            <div class="day-card detail-card" data-date="12/31" data-city="Gotemba">
                <div class="weather-info">
                    12/31 å¯Œå£«å±±-å¾¡æ®¿å ´ | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 12/31 æ·ºè‰ â†’ å¯Œå£«å±± </h2>
                <p><strong> ä½å®¿:</strong> Hotel Clad</p>
                <h3>ğŸš— äº¤é€šï¼š</h3>
                <p>å–è»Šåœ°é»:NIPPONç§Ÿè»Šå…¬å¸ TXæ·ºè‰
                    æ±äº¬éƒ½å°æ±åŒºè¥¿æµ…è‰3-27-4</p>
                <p>æ™‚é–“:12/31 08:00-1/1 20:00</p>
                <p>è‡ªé§•åˆ°hotel cladç´„ 1.5 - 2 å°æ™‚</p>
                <button class="nav-button" data-location="Hotel Clad">å°èˆªåˆ° Hotel Clad </button>
            </div>
        </section>

        <section id="day-1-1" class="itinerary-day hidden">
            <div class="day-card current-vibe-card" style="background-image: url('image/fuji.jpg');">
                <p>ğŸ—» å¯Œå£«å±±</p></div>
            <div class="day-card detail-card" data-date="1/1" data-city="Fujikawaguchiko">
                <div class="weather-info">
                    1/1 å¯Œå£«å±±-æ²³å£æ¹– | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 1/1 å¯Œå£«å±± â†’ ä¸Šé‡ </h2>
                <p><strong>ä½å®¿:</strong> Hotel Apreton</p>                        
                <h3>ğŸ“ è¡Œç¨‹</h3>
                <ul><li>å¿é‡å…«æµ·</li>
                    <li>æ–°å€‰å±±æ·ºé–“å…¬åœ’</li>
                    <li>å‰ç”°æœ¬ç”ºå•†åº—è¡—</li>
                </ul>
                <button class="nav-button" data-location="Hotel Apreton">å°èˆªåˆ° Hotel Apreton</button>
            </div>
        </section>

        <section id="day-1-2" class="itinerary-day hidden">
            <div class="day-card current-vibe-card" style="background-image: url('image/kamakura.jpg');">
                <p>ğŸŒŠ éŒå€‰</p></div>
            <div class="day-card detail-card" data-date="1/2" data-city="Kamakura">
                <div class="weather-info">
                    1/2 éŒå€‰å¸‚ | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 1/2 éŒå€‰</h2>
                <h3>ğŸš† äº¤é€š</h3>
                <p>ä¸Šé‡ç«™ â†’ï¼ˆJR ä¸Šé‡æ±äº¬ Lineï¼‰â†’ éŒå€‰ç«™</p>                
                <h4>ğŸ“ è¡Œç¨‹</h3>
                <ul>
                    <li>æ±Ÿä¹‹å³¶</li>
                    <li>çŒç±ƒé«˜æ‰‹å¹³äº¤é“</li>
                    <li>å°ç”ºé€š</li>                    
                </ul>
            </div>
        </section>

        <section id="day-1-3" class="itinerary-day hidden">
            <div class="day-card current-vibe-card" style="background-image: url('image/ueno.jpg');">
                <p>ğŸŒ¸ ä¸Šé‡</p></div>
            <div class="day-card detail-card" data-date="1/3" data-city="Taito">
                <div class="weather-info">
                    1/3 ä¸Šé‡ | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 1/3 ä¸Šé‡</h2>
                <h3>ğŸ“ è¡Œç¨‹</h3>
                <ul>
                    <li>é˜¿ç¾æ©«ä¸ </li>
                    <li>ä¸Šé‡å…¬åœ’</li>                    
                    <li>ä¸Šé‡ Yodobashi Camera</li>
                </ul>
            </div>
        </section>

        <section id="day-1-4" class="itinerary-day hidden">
            <div class="day-card current-vibe-card" style="background-image: url('image/home.jpg');">
                <p>âœˆï¸ Home</p></div>
            <div class="day-card detail-card" data-date="1/4" data-city="Narita">
                <div class="weather-info">
                    1/4 æˆç”°æ©Ÿå ´ | å¤©æ°£ï¼šè¼‰å…¥ä¸­...
                </div>
                <h2>ğŸ—“ï¸ 1/4 å›å®¶</h2>
                
                <p><strong>ğŸš¨ å›ç¨‹:</strong> 11:25 é£›æ©Ÿï¼Œæª¢æŸ¥è¡Œæ</p>
                <h3>ğŸ“ è¡Œç¨‹</h3>
                <ul>
                    <li>é è¨ˆ06:00èµ·åºŠå‰å¾€æ©Ÿå ´</li>
                    <li>æ©Ÿå ´å‘¨é‚Š</li>
                </ul>
            </div>
        </section>
        
        <section id="info" class="tool-section hidden">
            <h2>âœˆï¸ æ—…éŠè³‡è¨Šèˆ‡ç·Šæ€¥è¯çµ¡</h2>
            <div class="info-card day-card">
                <h3>ğŸ’° æ—…éŠè²»ç”¨ç¸½è¦½</h3>
                <ul>
                    <li>æ©Ÿç¥¨ç¸½è¨ˆ: <strong>28,856</strong> (13478 + 15078)</li>
                    <li>ä½å®¿ç¸½è¨ˆ: <strong>44,274</strong> (19946 + 13221 + 11107)</li>
                    <li>ç§Ÿè»Šç¸½è¨ˆ: <strong>Â¥24,200</strong></li> 
                </ul>
            </div>

            <div class="info-card day-card">
                <h3>âœˆï¸ èˆªç­è³‡è¨Š</h3>
                <ul>
                    <li>12/27 IT200</li>
                    <p>TPE-NRT:06:10-10:35</p>
                    <li>01/04 IT201</li>
                    <p>NRT-TPE:11:25-14:45</p>
                </ul>
            </div>

            <div class="info-card day-card">
                <h3>ğŸš¨ ç·Šæ€¥è¯çµ¡æ–¹å¼</h3>
                <ul>
                    <li>å°ç£é§æ—¥ä»£è¡¨è™•: (+81) 3-3280-7811</li>
                    <li>æ—¥æœ¬å ±è­¦ (è­¦å¯Ÿ): <strong>110</strong></li>
                    <li>æ—¥æœ¬æ•‘è­·è»Š/ç«è­¦: <strong>119</strong></li>
                </ul>
            </div>
        </section>

        <section id="budget" class="tool-section hidden">
            
            <h2>ğŸ’° è¨˜å¸³ </h2>
          
            <div class="input-form">
                <input type="text" id="expense-item" placeholder="é …ç›® (e.g. åˆé¤)">
                <input type="number" id="expense-amount" placeholder="é‡‘é¡ (JPY)">
                <select id="expense-category">
                    <option value="food">é¤é£²</option>
                    <option value="traffic">äº¤é€š</option>
                    <option value="shopping">è³¼ç‰©</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <button id="add-expense-btn">add</button>
            </div>

            <h3>ç¸½èŠ±è²»ï¼š<span id="total-amount">Â¥ 0</span></h3>
            <ul id="expense-list">
                </ul>
            <button id="export-csv-btn">åŒ¯å‡ºè¨˜å¸³è¡¨</button>
        </section>
        
        <section id="narita-guide" class="itinerary-day guide-page hidden">
            <a id="back-to-12-27" class="back-button">
                <strong>â¬…ï¸ ä¸Šä¸€é </strong>
            </a>
            <h2>æˆç”°æ©Ÿå ´ â†’ æ·ºè‰(å…©ç¨®æ–¹å¼)</h2>
            <p><strong>é è¨ˆæ™‚é–“ï¼š</strong> ç´„ 65 - 80 åˆ†é˜</p>            
            <h3>è·¯ç·šï¼š</h3>
            <div class="tip-card">
                <p><strong>äº¬æˆé›»éµSkyliner </strong></p>
                <ul>
                    <li>æ­åˆ°äº¬åŸä¸Šé‡</li>
                    <li>èµ°åˆ°ã€Œä¸Šé‡åœ°éµç«™ï¼ˆéŠ€åº§ç·šï¼‰ã€</li>
                    <li>æ­éŠ€åº§ç·šï¼ˆGï¼‰å¾€ æ·ºè‰</li>
                </ul>
            </div>
            
            <div class="tip-card">
                <p><strong>äº¬æˆç‰¹å¿«Access</strong></p>
                <ul>
                    <li>æ­åˆ°æŠ¼ä¸Š</li>
                    <li>æ­ä¹˜éƒ½ç‡Ÿæ·ºè‰ç·šï¼ˆToei Asakusa Lineï¼‰</li>
                </ul>
            </div>
         </section>

    </main>

    <footer class="tab-bar" id="main-tab-bar">
        <a href="#day-12-27" id="tab-itinerary" class="active">è¡Œç¨‹</a>
        <a href="#info" id="tab-info">è³‡è¨Š</a>
        <a href="#budget" id="tab-budget">è¨˜å¸³</a>
    </footer>

    <script src="app.js"></script>
    
    <script>
        // --- [å¤©æ°£ API ä¸²æ¥é‚è¼¯] ---
        const API_KEY = '0a105245bb3204d9430443e75d49c05c'; 
        const WEATHER_API_URL = 'https://api.openweathermap.org/data/2.5/weather';

        async function fetchWeatherForCity(city) {
            const url = `${WEATHER_API_URL}?q=${city},JP&appid=${API_KEY}&units=metric&lang=zh_tw`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    console.error(`ç„¡æ³•ç²å– ${city} çš„å¤©æ°£ (HTTP ç‹€æ…‹ç¢¼: ${response.status})ï¼š`, response.statusText);
                    return null;
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("å¤©æ°£ API ç¶²è·¯è«‹æ±‚éŒ¯èª¤:", error);
                return null;
            }
        }

        function updateWeatherDisplay(detailCard, weatherData) {
            const weatherInfoDiv = detailCard.querySelector('.weather-info');
            if (!weatherInfoDiv) return;

            if (!weatherData || !weatherData.main || !weatherData.weather || weatherData.weather.length === 0) {
                weatherInfoDiv.innerHTML = `<span style="color: red;">[å¤©æ°£è¼‰å…¥å¤±æ•—]</span>`;
                return;
            }

            const temp = Math.round(weatherData.main.temp); 
            const description = weatherData.weather[0].description; 
            const originalText = weatherInfoDiv.textContent.trim();
            const locationMatch = originalText.match(/(\d{1,2}\/\d{1,2}\s[^\s|]+)/); 
            const locationDate = locationMatch ? locationMatch[1] : weatherData.name; 

            weatherInfoDiv.innerHTML = `
                <span style="font-weight: bold;">${locationDate}</span>
                <span style="color: #FF7043;">| ${description}ï¼Œ${temp}Â°C</span>
            `;
        }

        async function loadAllWeather() {
            const detailCards = document.querySelectorAll('.day-card.detail-card');
            for (const card of detailCards) {
                const city = card.getAttribute('data-city');
                if (city) {
                    await new Promise(resolve => setTimeout(resolve, 150)); 
                    const weatherData = await fetchWeatherForCity(city);
                    updateWeatherDisplay(card, weatherData);
                }
            }
        }
        
        // --- [å¤©æ°£ API ä¸²æ¥é‚è¼¯çµæŸ] ---
        
        // è¨»å†Š Service Worker å¯¦ç¾ PWA åŠŸèƒ½ 
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
            .then(reg => console.log('Service Worker è¨»å†ŠæˆåŠŸ:', reg.scope))
            .catch(err => console.error('Service Worker è¨»å†Šå¤±æ•—:', err));
        }

        // --- Tab é é¢åˆ‡æ›é‚è¼¯ ---

        const dayTabsContainer = document.getElementById('day-tabs-container');
        const mainTabs = document.querySelectorAll('#main-tab-bar a');
        const daySections = document.querySelectorAll('.itinerary-day:not(.guide-page)'); // æ’é™¤æ”»ç•¥é é¢
        const guideSections = document.querySelectorAll('.guide-page'); // æ”»ç•¥é é¢
        const toolSections = document.querySelectorAll('.tool-section');
        const dayIds = Array.from(daySections).map(section => section.id);


        // ----------------------------------------------------
        // I. åˆå§‹åŒ–ï¼šå»ºç«‹é ‚éƒ¨æ—¥æœŸ Tab
        // ----------------------------------------------------

        function buildDayTabs() {
            dayTabsContainer.innerHTML = '';
            dayIds.forEach((id, index) => {
                const tabText = id.replace('day-', '').replace('-', '/'); 

                const tabLink = document.createElement('a');
                tabLink.href = `#${id}`;
                tabLink.textContent = tabText;
                tabLink.id = `day-tab-${id}`;
                
                if (index === 0) {
                    tabLink.classList.add('active');
                }

                tabLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchDayContent(id); 
                    if (history.pushState) {
                        history.pushState(null, null, `#${id}`); 
                    } else {
                        window.location.hash = id; 
                    }
                });
                dayTabsContainer.appendChild(tabLink);
            });
        }
        
        // ----------------------------------------------------
        // II. åˆ‡æ›æ—¥æœŸå…§å®¹ (é ‚éƒ¨ Tab)
        // ----------------------------------------------------

        function switchDayContent(targetDayId) {
            // éš±è—æ‰€æœ‰æ—¥æœŸå…§å®¹ (åŒ…å«æ”»ç•¥é é¢)
            [...daySections, ...guideSections].forEach(section => {
                section.classList.remove('active-page');
                section.classList.add('hidden');
            });
            
            // é¡¯ç¤ºç›®æ¨™æ—¥æœŸå…§å®¹
            const targetSection = document.getElementById(targetDayId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('active-page');
            }

            // æ›´æ–°é ‚éƒ¨æ—¥æœŸå°è¦½åˆ—çš„ active ç‹€æ…‹
            dayTabsContainer.querySelectorAll('a').forEach(tab => {
                tab.classList.remove('active');
            });
            const activeTab = document.getElementById(`day-tab-${targetDayId}`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.scrollIntoView({ behavior: 'smooth', inline: 'center' }); 
            }
        }
        
        // ----------------------------------------------------
        // III. åˆ‡æ›æ”»ç•¥é é¢ (ç”±æŒ‰éˆ•è§¸ç™¼)
        // ----------------------------------------------------
        
        function switchGuidePage(guideId, backDayId) {
            // éš±è—æ‰€æœ‰å€å¡Š
            [...daySections, ...guideSections, ...toolSections].forEach(section => {
                section.classList.remove('active-page');
                section.classList.add('hidden');
            });

            // é¡¯ç¤ºæ”»ç•¥é é¢
            const guideSection = document.getElementById(guideId);
            if (guideSection) {
                guideSection.classList.remove('hidden');
                guideSection.classList.add('active-page');
            }
            
            dayTabsContainer.style.display = 'none'; // éš±è—æ—¥æœŸ Tab
            
            // æ›´æ–° URL hash
            if (history.pushState) {
                history.pushState(null, null, `#${guideId}`);
            }
            
            // å„²å­˜è¿”å› IDï¼Œä¾›è¿”å›æŒ‰éˆ•ä½¿ç”¨
            guideSection.setAttribute('data-back-to', backDayId); 
            
            // åº•éƒ¨ Tab æ¢å¾©åˆ° è¡Œç¨‹ ç‹€æ…‹
            mainTabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById('tab-itinerary').classList.add('active');
        }


        // ----------------------------------------------------
        // IV. åˆ‡æ›ä¸»è¦é é¢ (åº•éƒ¨ Tab)
        // ----------------------------------------------------
        
        function switchMainTab(targetId) {
            // éš±è—æ‰€æœ‰å€å¡Š (æ—¥æœŸã€æ”»ç•¥ã€å·¥å…·)
            [...daySections, ...guideSections, ...toolSections].forEach(section => {
                section.classList.remove('active-page');
                section.classList.add('hidden');
            });
            
            // åˆ¤æ–·è¦é¡¯ç¤ºå“ªå€‹å€å¡Š
            if (targetId === 'info' || targetId === 'budget') {
                // é¡¯ç¤ºå·¥å…·å€å¡Š
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    targetSection.classList.add('active-page');
                }
                dayTabsContainer.style.display = 'none'; // éš±è—æ—¥æœŸ Tab
            } else { 
                // é¡¯ç¤ºè¡Œç¨‹å€å¡Š (é è¨­è·³è½‰åˆ°ç•¶å‰çš„æ—¥æœŸ)
                const currentDayId = targetId.startsWith('day-') ? targetId : dayIds[0];
                switchDayContent(currentDayId);
                dayTabsContainer.style.display = 'flex'; // é¡¯ç¤ºæ—¥æœŸ Tab
            }
            
            // æ›´æ–°åº•éƒ¨å°è¦½åˆ—çš„ active ç‹€æ…‹
            mainTabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            const mainTabId = targetId.startsWith('day-') || targetId.includes('guide') ? 'itinerary' : targetId;
            const activeMainTab = document.getElementById(`tab-${mainTabId}`);
            if (activeMainTab) {
                activeMainTab.classList.add('active');
            }
        }
        
        // ----------------------------------------------------
        // V. é é¢è¼‰å…¥æ™‚åŸ·è¡Œ / æŒ‰éˆ•äº‹ä»¶ç›£è½
        // ----------------------------------------------------
        
        document.addEventListener('DOMContentLoaded', async () => {
            // 1. å»ºç«‹é ‚éƒ¨æ—¥æœŸ Tab
            buildDayTabs();
            
            // 2. ç›£è½åº•éƒ¨ Tab Bar é»æ“Šäº‹ä»¶ (ä¿æŒåŸæœ‰é‚è¼¯)
            mainTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = tab.getAttribute('href').substring(1); 
                    switchMainTab(targetId); 
                    window.location.hash = targetId; 
                });
            });

            // 3. åˆå§‹åŒ–ï¼šæª¢æŸ¥ URL Hash æˆ–é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹è¡Œç¨‹
            const initialHash = window.location.hash.substring(1);
            if (initialHash && document.getElementById(initialHash)) {
                if (initialHash.startsWith('day-') || initialHash === 'info' || initialHash === 'budget' || initialHash.endsWith('-guide')) {
                    // å¦‚æœæ˜¯æ—¥æœŸã€å·¥å…·æˆ–æ”»ç•¥é é¢ï¼Œå‰‡ç›´æ¥åˆ‡æ›é¡¯ç¤º
                    if (initialHash.startsWith('day-')) {
                        switchDayContent(initialHash);
                        dayTabsContainer.style.display = 'flex';
                        switchMainTab('day-12-27'); // ç¢ºä¿åº•éƒ¨ Tab ç‹€æ…‹æ­£ç¢º
                    } else if (initialHash.endsWith('-guide')) {
                        // å¦‚æœæ˜¯æ”»ç•¥é é¢ï¼Œå‰‡éœ€è¦ç‰¹æ®Šè™•ç†é¡¯ç¤º
                         document.getElementById(initialHash).classList.remove('hidden');
                         document.getElementById(initialHash).classList.add('active-page');
                         dayTabsContainer.style.display = 'none';
                         switchMainTab('day-12-27'); // ç¢ºä¿åº•éƒ¨ Tab ç‹€æ…‹æ­£ç¢º
                    } else {
                         switchMainTab(initialHash);
                    }
                }
            } else {
                // é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹è¡Œç¨‹ section
                switchMainTab(dayIds[0]);
            }
            
            // 4. ç›£è½ Hash æ”¹è®Šäº‹ä»¶ (è™•ç†ç€è¦½å™¨å›é€€)
            window.addEventListener('hashchange', () => {
                const hash = window.location.hash.substring(1);
                if (hash) {
                    switchMainTab(hash);
                }
            });

            // 5. å°èˆªæŒ‰éˆ• (ä¿æŒåŸæœ‰åŠŸèƒ½)
            document.querySelectorAll('.nav-button').forEach(button => {
                button.addEventListener('click', () => {
                    const location = button.getAttribute('data-location');
                    if (location) {
                        window.open(`http://maps.google.com/?q=${encodeURIComponent(location)}`, '_blank');
                    }
                });
            });

            // 6. æ–°å¢ï¼šæˆç”°æ©Ÿå ´æ”»ç•¥æŒ‰éˆ•é‚è¼¯
            const naritaButton = document.getElementById('narita-guide-button');
            const naritaBackButton = document.getElementById('back-to-12-27');
            
            if (naritaButton) {
                naritaButton.addEventListener('click', () => {
                    // åˆ‡æ›åˆ°æ”»ç•¥é é¢ï¼Œä¸¦å‘ŠçŸ¥è¿”å›æ™‚è¦å› 12/27
                    switchGuidePage('narita-guide', 'day-12-27');
                });
            }
            
            if (naritaBackButton) {
                naritaBackButton.addEventListener('click', () => {
                    // è¿”å›æŒ‰éˆ•é»æ“Šå¾Œï¼Œåˆ‡æ›å›æŒ‡å®šçš„æ—¥æœŸè¡Œç¨‹
                    const backToId = naritaBackButton.parentNode.getAttribute('data-back-to') || 'day-12-27';
                    switchDayContent(backToId);
                    dayTabsContainer.style.display = 'flex'; // é¡¯ç¤ºæ—¥æœŸ Tab
                    if (history.pushState) {
                        history.pushState(null, null, `#${backToId}`);
                    }
                });
            }

            // 7. DOM è¼‰å…¥å¾ŒåŸ·è¡Œå¤©æ°£æŸ¥è©¢
            await loadAllWeather(); 
        });

    </script>
</body>
</html>












