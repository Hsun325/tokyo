<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tokyo</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    <header class="app-header">
        <h1>王小棠的東京生日之旅 🐱</h1>
    </header>

    <main class="content-container">
            
        <section id="day-12-27" class="itinerary-day active-tab">
            <div class="day-card" data-date="12/27">
                <div class="weather-info">
                    ☁️ 12/27 淺草 | 天氣：多雲，14°C
                </div>
                <h2>🗓️ 12/27 淺草、秋葉原</h2>
                <p><strong>飯店:</strong> 花築淺草和心飯店</p>
                
                <h3>📍 景點：</h3>
                <ul>
                    <li>淺草寺 / 仲見世商店街</li>
                    <li>合羽橋道具街</li>
                    <li>秋葉原</li>
                    <li>晴空塔</li>
                </ul>
                
            </div>
        </section>

        <section id="day-12-28" class="itinerary-day hidden">
            <div class="day-card" data-date="12/28">
                <div class="weather-info">
                    🎢 12/28 disney-Sea | 天氣：晴朗，13°C
                </div>
                <h2>🗓️ 12/28 disney-Sea </h2>
                <p><strong>🚨 交通提醒:</strong> 從淺草搭地鐵轉JR京葉線至舞濱站，請提早出發。</p>
                
                <h3>🚆 交通路線：</h3>
                <p>淺草 (人形町站) → 日比谷線 (八丁堀站) → JR京葉線 → 舞濱站。</p>
                                
            </div>
        </section>

        <section id="day-12-29" class="itinerary-day hidden">
            <div class="day-card" data-date="12/29">
                <div class="weather-info">
                    ☀️ 12/29 新宿・澀谷 | 天氣：多雲時晴，12°C
                </div>
                <h2>🗓️ 12/29 新宿、澀谷、東京鐵塔</h2>
                
                <h3>📍 景點攻略：</h3>
                <ul>
                    <li>明治神宮</li>
                    <li>澀谷 Shibuya Sky</li>
                    <li>東京鐵塔</li>
                    <li>惠比壽</li>
                </ul>
                
            </div>
        </section>

        <section id="day-12-30" class="itinerary-day hidden">
            <div class="day-card" data-date="12/30">
                <div class="weather-info">
                    🐱 12/30 豪德寺 | 天氣：晴朗，13°C
                </div>
                <h2>🗓️ 12/30 招財貓豪德寺</h2>
                
                <h3>🐱 豪德寺攻略：</h3>
                <p>豪德寺是招財貓的起源地，擁有上千隻招財貓奉納。氣氛寧靜，非常適合拍照。建議搭配周邊世田谷線一日遊。</p>
                
                <h3>🍴 午餐</h3>
                <p>看要吃啥</p>
                
            </div>
        </section>

        <section id="day-12-31" class="itinerary-day hidden">
            <div class="day-card" data-date="12/31">
                <div class="weather-info">
                    🗻 12/31 富士山 | 天氣：多雲，5°C
                </div>
                <h2>🗓️ 12/31 淺草 → 富士山 </h2>
                <p><strong> 住宿:</strong> Hotel Clad</p>
                
                <h3>📍 河口湖周邊景點：</h3>
                <ul>
                    <li>忍野八海</li>
                    <li>新倉山淺間公園</li>
                    <li>吉田本町商店街</li>
                </ul>
                <button class="nav-button" data-location="Hotel Clad">導航到 Hotel Clad </button>
            </div>
        </section>

        <section id="day-1-1" class="itinerary-day hidden">
            <div class="day-card" data-date="1/1">
                <div class="weather-info">
                    ☀️ 1/1 御殿場市 | 天氣：晴朗，5°C
                </div>
                <h2>🗓️ 1/1 富士山 → 上野 </h2>
                
                <h3> 住宿</h3>
                <p>Hotel Apreton</p>
                
                <h3>🚗 交通：</h3>
                <p>自駕從御殿場回上野約 1.5 - 2 小時</p>
                <button class="nav-button" data-location="御殿場 Premium Outlet">導航到 Hotel Apreton</button>
            </div>
        </section>

        <section id="day-1-2" class="itinerary-day hidden">
            <div class="day-card" data-date="1/2">
                <div class="weather-info">
                    🌊 1/2 鎌倉市 | 天氣：多雲轉晴，10°C
                </div>
                <h2>🗓️ 1/2 鎌倉一日遊 (歷史古都)</h2>
                
                <h3>📍 景點攻略：</h3>
                <ul>
                    <li>鶴岡八幡宮</li>
                    <li>鎌倉大佛</li>
                    <li>小町通</li>
                    <li>江之電</li>
                </ul>
            
            </div>
        </section>

        <section id="day-1-3" class="itinerary-day hidden">
            <div class="day-card" data-date="1/3">
                <div class="weather-info">
                    🐘 1/3 上野 | 天氣：晴朗，11°C
                </div>
                <h2>🗓️ 1/3 上野 (文化與購物)</h2>
                <p><strong>🚨 逛街:</strong>隨便逛逛 </p>
                
                <h3>📍 景點/購物：</h3>
                <ul>
                    <li>上野公園:</li>
                    <li>阿美橫丁 </li>
                    <li>上野動物園</li>
                </ul>

            </div>
        </section>

        <section id="day-1-4" class="itinerary-day hidden">
            <div class="day-card" data-date="1/4">
                <div class="weather-info">
                    🐘 1/4 上野 | 天氣：晴朗，11°C
                </div>
                <h2>🗓️ 1/4 回家</h2>
                <p><strong>🚨 回程:</strong> 11:25 飛機，檢查行李</p>
                
                <h3>📍 景點/購物：</h3>
                <ul>
                    <li>機場周邊</li>                 
                </ul>
            </div>
        </section>

        <section id="info" class="tool-section hidden">
            <h2>✈️ 旅遊資訊與緊急聯絡</h2>
                        
            <div class="info-card day-card">
                <h3>💰 旅遊費用總覽</h3>
                <ul>
                    <li>機票總計: <strong>28,856</strong> (13478 + 15078)</li>
                    <li>住宿總計: <strong>44,274</strong> (19946 + 13221 + 11107)</li>                   
                </ul>
            </div>

            <div class="info-card day-card">
                <h3>✈️ 航班資訊</h3>
                <ul>
                    <li>12/27 TPE-NRT:06:10-10:35</li>
                    <li>01/04 NRT-TPE:11:25-14:45</li>
                </ul>
            </div>

            <div class="info-card day-card">
                <h3>🚨 緊急聯絡方式</h3>
                <ul>
                    <li>台灣駐日代表處: (+81) 3-3280-7811</li>
                    <li>日本報警 (警察): <strong>110</strong></li>
                    <li>日本救護車/火警: <strong>119</strong></li>
                </ul>
            </div>
        </section>

        <section id="budget" class="tool-section hidden">
            <h2>💰 記帳 </h2>
          
            <div class="input-form">
                <input type="text" id="expense-item" placeholder="項目 (e.g. 午餐)">
                <input type="number" id="expense-amount" placeholder="金額 (JPY)">
                <select id="expense-category">
                    <option value="food">餐飲</option>
                    <option value="traffic">交通</option>
                    <option value="shopping">購物</option>
                    <option value="other">其他</option>
                </select>
                <button id="add-expense-btn">新增紀錄</button>
            </div>

            <h3>總花費：<span id="total-amount">¥ 0</span></h3>
            <ul id="expense-list">
                </ul>
            <button id="export-csv-btn">匯出記帳表</button>
        </section>

    </main>

    <footer class="tab-bar">
    </footer>

    <script src="app.js"></script>
    <script>
        // 註冊 Service Worker 實現 PWA 功能 
        if ('serviceWorker' in navigator) {
            // 由於您有快取問題，這裡需要確保 service-worker.js 是最新的
            navigator.serviceWorker.register('/service-worker.js')
            .then(reg => console.log('Service Worker 註冊成功:', reg.scope))
            .catch(err => console.error('Service Worker 註冊失敗:', err));
        }

        // --- Tab 頁面切換邏輯 (動態行程 Tab) ---

        // 取得所有內容區塊 (所有帶有 id 的 section)
        const contentSections = document.querySelectorAll('.content-container > section');
        const tabBar = document.querySelector('.tab-bar');

        // 1. 建立 Tab Bar (動態生成)
        function buildTabBar() {
            tabBar.innerHTML = '';
            
            // 遍歷所有 section 並為其創建 Tab
            contentSections.forEach(section => {
                const id = section.id; // e.g., 'day-12-27', 'info', 'budget'
                let tabText = '';

                // 判斷 Tab 顯示的文字
                if (id.startsWith('day-')) {
                    // 從 'day-12-27' 提取 '12/27'
                    tabText = id.replace('day-', '').replace('-', '/');
                } else if (id === 'info') {
                    tabText = '資訊';
                } else if (id === 'budget') {
                    tabText = '記帳';
                } else {
                    return; // 忽略不處理的 section
                }

                const tabLink = document.createElement('a');
                tabLink.href = `#${id}`;
                tabLink.id = `tab-${id}`;
                tabLink.textContent = tabText;
                
                // 綁定切換事件
                tabLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    // 點擊後更新 URL Hash，方便分享和瀏覽器回退
                    window.location.hash = id; 
                });

                tabBar.appendChild(tabLink);
            });
        }

        // 2. 切換 Tab 邏輯
        function switchTab(targetId) {
            // 隱藏所有內容區塊
            contentSections.forEach(section => {
                section.classList.remove('active-tab');
                section.classList.add('hidden');
            });
            
            // 顯示目標區塊
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('active-tab');
            }
            
            // 更新底部導覽列的 active 狀態
            tabBar.querySelectorAll('a').forEach(tab => {
                tab.classList.remove('active');
            });
            const activeTab = document.getElementById(`tab-${targetId}`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }

        // 3. 頁面載入時執行
        buildTabBar();
        
        // 初始化：檢查 URL Hash 或預設顯示第一個行程
        const firstSectionId = contentSections[0].id; // 應該是 'day-12-27'
        const initialHash = window.location.hash.substring(1);
        
        if (initialHash && document.getElementById(initialHash)) {
            switchTab(initialHash);
        } else {
            // 預設顯示第一個行程 section
            switchTab(firstSectionId);
        }
        
        // 當頁面 hash 改變時 (e.g., 點擊 Tab 或使用瀏覽器回退)
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1) || firstSectionId;
            switchTab(hash);
        });

        // 導航按鈕 (保持原有功能)
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => {
                const location = button.getAttribute('data-location');
                if (location) {
                    window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
                }
            });
        });

    </script>
</body>
</html>
